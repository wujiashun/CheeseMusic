name: Release
on:
    push:
      tags:
        - '*'  # 任何标签的推送都会触发

jobs:
  release:
    # 服务器环境：最新版 Ubuntu
    runs-on: ubuntu-latest
    steps:
      # 拉取代码
      - name: pull
        uses: actions/checkout@v2
        with:
          persist-credentials: false
      - name: Install Wine
        run: |
            sudo dpkg --add-architecture i386
            sudo mkdir -pm755 /etc/apt/keyrings
            sudo wget -O /etc/apt/keyrings/winehq-archive.key https://dl.winehq.org/wine-builds/winehq.key
            sudo wget -NP /etc/apt/sources.list.d/ https://dl.winehq.org/wine-builds/ubuntu/dists/$(lsb_release -cs)/winehq-$(lsb_release -cs).sources
            sudo apt update
            sudo apt install --install-recommends winehq-stable
  
      # 1、生成静态文件
      - name: Build
        run: npm install && npm run build:win
      # 2、发布release
      - name: Create Release
        uses: ncipollo/release-action@v1.14.0
        with:
            token: ${{ secrets.ACCESS_TOKEN }}
            artifacts: 'dist/*.exe'
            body: '该发行版由 GitHub Actions 自动发布'